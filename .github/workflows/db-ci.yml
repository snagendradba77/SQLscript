name: Database CI/CD

on:
  push:
    paths:
      - 'sql/**'   # Trigger workflow when anything in sql/ changes

jobs:
  run-sql-scripts:
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Execute SQL scripts
        env:
          SA_PASSWORD: ${{ secrets.SA_PASSWORD }} #Load the github secret into an environment  
        run: |
          echo "Running SQL scripts..."
          echo "Length of SA_PASSWORD: ${#SA_PASSWORD}"
          for f in sql/*.sql; do
            echo "Executing $f"
            /opt/mssql-tools18/bin/sqlcmd -S localhost.localdomain -U sa -P "$SA_PASSWORD" -C -i "$f"
          done
